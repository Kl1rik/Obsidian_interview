#Linux #Docker 
![[Pasted image 20240828124949.png]]
Пример cgroups в RHEL
## Устройство **cgroups**
### RHEL
- **System** – демоны и сервисы.
- **User** – пользовательские сеансы. Каждый пользователь получает свой дочерний слайс, причем все сеансы с одинаковым UID «живут» в одном и том же слайсе, чтобы особо ушлые умники не могли получить ресурсов больше положенного.
- **Machine** – виртуальные машины, типа KVM-гостей.
### Docker
![[Pasted image 20240828130148.png]]
- **cpu**: Управляет распределением процессорного времени между процессами. Позволяет устанавливать приоритеты (через шедулеры) и ограничивать использование CPU.
- **cpuacct**: Подсистема учета использования CPU, которая отслеживает, сколько времени процессорного времени использовали процессы внутри `cgroup`.
- **cpuset**: Определяет, на каких процессорных ядрах и на каких узлах памяти (для NUMA) могут выполняться процессы. Это позволяет привязывать процессы к определенным ядрам и памяти.
- **memory**: Управляет и отслеживает использование оперативной памяти и свопа. Поддерживает лимиты, мягкие лимиты и заморозку процессов в случае превышения лимитов.
- **blkio**: Управляет вводом/выводом с блоковых устройств (таких как жесткие диски и SSD). Позволяет ограничивать скорость чтения и записи для процессов.
- **net_cls** и **net_prio**: Позволяют управлять и классифицировать сетевой трафик процессов. `net_cls` позволяет маркировать пакеты, а `net_prio` — устанавливать приоритеты для трафика.
- **freezer**: Подсистема, которая позволяет "заморозить" или "разморозить" процессы внутри `cgroup`. Это полезно для создания контрольных точек или приостанавливать выполнение процессов.
- **devices**: Управляет доступом процессов к устройствам. Позволяет разрешать или запрещать доступ к определенным устройствам (например, к дискам, сетевым картам и т. д.).
- **pids**: Ограничивает количество процессов, которые могут быть созданы внутри `cgroup`. Это предотвращает исчерпание доступных PID и защищает систему от ошибок типа "fork bomb".
- **hugetlb**: Управляет использованием больших страниц памяти (Huge Pages). Позволяет устанавливать лимиты на использование Huge Pages.
- **rdma**: Подсистема для управления использованием ресурсов RDMA (Remote Direct Memory Access), которые важны для высокопроизводительных вычислений и сетевых приложений.
## Основные возможности
- Ограничение ресурсов ,установки CPU quotas для пользователей в качестве абсолютного значения через env файл (==/etc/systemd/system==)
- Приоритезация ресурсов для разных категорий 
- Один из  механизмов изоляции
- ==Активно используется в Docker и LXC(Proxmox)==
- Позволяет учитывать все ресурсы хоста и удобно их распределять 
## Cgroups Hierarchy (Иерархия Cgroups)
![[cgroup ierarchy.canvas|cgroup ierarchy]]

- В контексте cgroups действует четкая иерархия в виде дерева
	- Вершина - `root cgroup (/sys/fs/cgroup)`
	- Узлы -  форки корневой cgroup со своими ограничениями 
	- Используя иерархию, можно организовать процессы по группам, которые будут наследовать настройки ресурсов от своих родительских групп.